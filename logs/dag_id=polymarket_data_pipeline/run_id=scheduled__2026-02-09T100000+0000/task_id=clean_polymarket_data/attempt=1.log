[2026-02-09T12:00:42.642+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: polymarket_data_pipeline.clean_polymarket_data scheduled__2026-02-09T10:00:00+00:00 [queued]>
[2026-02-09T12:00:42.654+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: polymarket_data_pipeline.clean_polymarket_data scheduled__2026-02-09T10:00:00+00:00 [queued]>
[2026-02-09T12:00:42.655+0000] {taskinstance.py:2170} INFO - Starting attempt 1 of 3
[2026-02-09T12:00:42.671+0000] {taskinstance.py:2191} INFO - Executing <Task(PythonOperator): clean_polymarket_data> on 2026-02-09 10:00:00+00:00
[2026-02-09T12:00:42.676+0000] {standard_task_runner.py:60} INFO - Started process 345 to run task
[2026-02-09T12:00:42.679+0000] {standard_task_runner.py:87} INFO - Running: ['***', 'tasks', 'run', 'polymarket_data_pipeline', 'clean_polymarket_data', 'scheduled__2026-02-09T10:00:00+00:00', '--job-id', '12', '--raw', '--subdir', 'DAGS_FOLDER/polymarket_pipeline_dag.py', '--cfg-path', '/tmp/tmpvzzyf01s']
[2026-02-09T12:00:42.681+0000] {standard_task_runner.py:88} INFO - Job 12: Subtask clean_polymarket_data
[2026-02-09T12:00:42.740+0000] {task_command.py:423} INFO - Running <TaskInstance: polymarket_data_pipeline.clean_polymarket_data scheduled__2026-02-09T10:00:00+00:00 [running]> on host 68f43ae3703b
[2026-02-09T12:00:42.818+0000] {taskinstance.py:2480} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='polymarket' AIRFLOW_CTX_DAG_ID='polymarket_data_pipeline' AIRFLOW_CTX_TASK_ID='clean_polymarket_data' AIRFLOW_CTX_EXECUTION_DATE='2026-02-09T10:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2026-02-09T10:00:00+00:00'
[2026-02-09T12:00:42.896+0000] {logging_mixin.py:188} INFO - ============================================================
[2026-02-09T12:00:42.897+0000] {logging_mixin.py:188} INFO -   üßπ √âTAPE 3: Nettoyage des donn√©es
[2026-02-09T12:00:42.897+0000] {logging_mixin.py:188} INFO - ============================================================
[2026-02-09T12:00:45.857+0000] {logging_mixin.py:188} INFO - ‚úÖ Monitoring MongoDB connect√© (polymarket_monitoring.pipeline_metrics)
[2026-02-09T12:00:45.868+0000] {logging_mixin.py:188} INFO - 
üîÑ Connexion √† MongoDB (polymarket_db)...
[2026-02-09T12:00:46.233+0000] {logging_mixin.py:188} INFO - ‚úÖ Documents dans 'polymarket': 600
[2026-02-09T12:00:46.262+0000] {logging_mixin.py:188} INFO - 
üîç Filtrage des documents...
[2026-02-09T12:00:46.524+0000] {logging_mixin.py:188} INFO -    ‚úì Trouv√© 234 documents valides
[2026-02-09T12:00:46.525+0000] {logging_mixin.py:188} INFO -    ‚úó Exclu 366 documents
[2026-02-09T12:00:46.525+0000] {logging_mixin.py:188} INFO - 
üßπ Nettoyage de 234 documents...
[2026-02-09T12:00:46.527+0000] {logging_mixin.py:188} INFO - 
üíæ Insertion dans 'polymarket_db.cleaned'...
[2026-02-09T12:00:47.608+0000] {logging_mixin.py:188} INFO - 
‚ùå Erreur lors du nettoyage: batch op errors occurred, full error: {'writeErrors': [{'index': 0, 'code': 11000, 'errmsg': "E11000 duplicate key error collection: polymarket_db.cleaned index: _id_ dup key: { _id: ObjectId('6989cc310b9ed2dd784b7eef') }", 'keyPattern': {'_id': 1}, 'keyValue': {'_id': ObjectId('6989cc310b9ed2dd784b7eef')}, 'op': {'_id': ObjectId('6989cc310b9ed2dd784b7eef'), 'id': '2890', 'ticker': 'nba-will-the-mavericks-beat-the-grizzlies-by-more-than-5pt5-points-in-their-december-4-matchup', 'slug': 'nba-will-the-mavericks-beat-the-grizzlies-by-more-than-5pt5-points-in-their-december-4-matchup', 'title': 'NBA: Will the Mavericks beat the Grizzlies by more than 5.5 points in their December 4 matchup?', 'description': 'In the upcoming NBA game, scheduled for December 4:\n\nIf the Dallas Mavericks win by over 5.5 points, the market will resolve to ‚ÄúYes‚Äù.\n\nIf the Memphis Grizzlies lose by less than 5.5 points or win, the market will resolve ‚ÄúNo.‚Äù \n\nIf the game is not completed by December 11, 2021, the market will resolve 50-50.', 'resolutionSource': 'https://www.nba.com/games', 'startDate': '2021-12-04T00:00:00Z', 'creationDate': '2021-12-04T00:00:00Z', 'endDate': '2021-12-04T00:00:00Z', 'image': 'https://polymarket-upload.s3.us-east-2.amazonaws.com/nba-will-the-mavericks-beat-the-grizzlies-by-more-than-55-points-in-their-december-4-matchup-543e7263-67da-4905-8732-cd3f220ae751.png', 'icon': 'https://polymarket-upload.s3.us-east-2.amazonaws.com/nba-will-the-mavericks-beat-the-grizzlies-by-more-than-55-points-in-their-december-4-matchup-543e7263-67da-4905-8732-cd3f220ae751.png', 'volume': 1335.05, 'category': 'Sports', 'published_at': '2022-07-27 14:40:02.064+00', 'createdAt': '2022-07-27T14:40:02.074Z', 'updatedAt': '2024-04-25T18:49:06.075795Z', 'commentCount': 8125, 'closedTime': '2022-07-27T14:40:02.074Z', 'seriesSlug': 'nba'}}], 'writeConcernErrors': [], 'nInserted': 0, 'nUpserted': 0, 'nMatched': 0, 'nModified': 0, 'nRemoved': 0, 'upserted': []}
[2026-02-09T12:00:48.616+0000] {taskinstance.py:2698} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/opt/airflow/dags/polymarket_pipeline_dag.py", line 308, in clean_polymarket_data_task
    result = target_collection.insert_many(batch)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/pymongo/_csot.py", line 125, in csot_wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/pymongo/synchronous/collection.py", line 975, in insert_many
    blk.execute(write_concern, session, _Op.INSERT)
  File "/home/airflow/.local/lib/python3.11/site-packages/pymongo/synchronous/bulk.py", line 751, in execute
    return self.execute_command(generator, write_concern, session, operation)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/pymongo/synchronous/bulk.py", line 614, in execute_command
    _raise_bulk_write_error(full_result)
  File "/home/airflow/.local/lib/python3.11/site-packages/pymongo/bulk_shared.py", line 131, in _raise_bulk_write_error
    raise BulkWriteError(full_result)
pymongo.errors.BulkWriteError: batch op errors occurred, full error: {'writeErrors': [{'index': 0, 'code': 11000, 'errmsg': "E11000 duplicate key error collection: polymarket_db.cleaned index: _id_ dup key: { _id: ObjectId('6989cc310b9ed2dd784b7eef') }", 'keyPattern': {'_id': 1}, 'keyValue': {'_id': ObjectId('6989cc310b9ed2dd784b7eef')}, 'op': {'_id': ObjectId('6989cc310b9ed2dd784b7eef'), 'id': '2890', 'ticker': 'nba-will-the-mavericks-beat-the-grizzlies-by-more-than-5pt5-points-in-their-december-4-matchup', 'slug': 'nba-will-the-mavericks-beat-the-grizzlies-by-more-than-5pt5-points-in-their-december-4-matchup', 'title': 'NBA: Will the Mavericks beat the Grizzlies by more than 5.5 points in their December 4 matchup?', 'description': 'In the upcoming NBA game, scheduled for December 4:\n\nIf the Dallas Mavericks win by over 5.5 points, the market will resolve to ‚ÄúYes‚Äù.\n\nIf the Memphis Grizzlies lose by less than 5.5 points or win, the market will resolve ‚ÄúNo.‚Äù \n\nIf the game is not completed by December 11, 2021, the market will resolve 50-50.', 'resolutionSource': 'https://www.nba.com/games', 'startDate': '2021-12-04T00:00:00Z', 'creationDate': '2021-12-04T00:00:00Z', 'endDate': '2021-12-04T00:00:00Z', 'image': 'https://polymarket-upload.s3.us-east-2.amazonaws.com/nba-will-the-mavericks-beat-the-grizzlies-by-more-than-55-points-in-their-december-4-matchup-543e7263-67da-4905-8732-cd3f220ae751.png', 'icon': 'https://polymarket-upload.s3.us-east-2.amazonaws.com/nba-will-the-mavericks-beat-the-grizzlies-by-more-than-55-points-in-their-december-4-matchup-543e7263-67da-4905-8732-cd3f220ae751.png', 'volume': 1335.05, 'category': 'Sports', 'published_at': '2022-07-27 14:40:02.064+00', 'createdAt': '2022-07-27T14:40:02.074Z', 'updatedAt': '2024-04-25T18:49:06.075795Z', 'commentCount': 8125, 'closedTime': '2022-07-27T14:40:02.074Z', 'seriesSlug': 'nba'}}], 'writeConcernErrors': [], 'nInserted': 0, 'nUpserted': 0, 'nMatched': 0, 'nModified': 0, 'nRemoved': 0, 'upserted': []}

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.11/site-packages/airflow/models/taskinstance.py", line 433, in _execute_task
    result = execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/airflow/operators/python.py", line 199, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/airflow/operators/python.py", line 216, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/polymarket_pipeline_dag.py", line 330, in clean_polymarket_data_task
    monitoring.log_error('cleaning', str(e))
TypeError: MongoMonitoringService.log_error() missing 1 required positional argument: 'error_message'
[2026-02-09T12:00:48.631+0000] {taskinstance.py:1138} INFO - Marking task as UP_FOR_RETRY. dag_id=polymarket_data_pipeline, task_id=clean_polymarket_data, execution_date=20260209T100000, start_date=20260209T120042, end_date=20260209T120048
[2026-02-09T12:00:48.648+0000] {standard_task_runner.py:107} ERROR - Failed to execute job 12 for task clean_polymarket_data (MongoMonitoringService.log_error() missing 1 required positional argument: 'error_message'; 345)
[2026-02-09T12:00:48.675+0000] {local_task_job_runner.py:234} INFO - Task exited with return code 1
[2026-02-09T12:00:48.700+0000] {taskinstance.py:3280} INFO - 0 downstream tasks scheduled from follow-on schedule check
