version: '3.8'

services:
  # ================================
  # üß© Service Kafka (broker KRaft)
  # ================================
  broker:
    image: apache/kafka:latest
    container_name: broker

    # ‚úÖ Expose les ports sur ta machine h√¥te (Windows)
    # - 9092 : port utilis√© par les clients (ton script Python producteur/consommateur)
    # - 9093 : port interne pour le contr√¥leur KRaft (pas utilis√© directement par ton script)
    ports:
      - "9092:9092"
      - "9093:9093"

    environment:
      # Identifiant unique du n≈ìud Kafka dans le cluster (ici un seul n≈ìud)
      KAFKA_NODE_ID: 1

      # R√¥les jou√©s par ce n≈ìud (broker + controller en mode KRaft, sans Zookeeper)
      KAFKA_PROCESS_ROLES: broker,controller

      # Listeners :
      # - 0.0.0.0 pour √©couter sur toutes les interfaces dans le conteneur
      #   => permet d‚Äôacc√©der √† Kafka depuis ta machine via localhost:9092
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093

      # Adresse "annonc√©e" aux clients.
      # - Pour un script qui tourne directement sur ta machine : localhost:9092
      # - Si tu veux qu‚Äôun autre conteneur se connecte, tu peux mettre : PLAINTEXT://broker:9092
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092

      # Nom du listener utilis√© par le contr√¥leur KRaft
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER

      # Mapping des protocoles de s√©curit√© pour chaque listener (tout en PLAINTEXT ici)
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT

      # Configuration du quorum KRaft (ici un seul contr√¥leur, ID=1, hostname=broker)
      # Si tu changes le nom du service, mets le m√™me ici (ex : 1@mon-broker:9093)
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@broker:9093

      # Facteurs de r√©plication √† 1 car on est en single-node
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: 1
      KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: 1

      # Param√®tres "confort" pour les consommateurs
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
      KAFKA_NUM_PARTITIONS: 3

    # üí° Optionnel : si tu veux persister les donn√©es Kafka sur ton disque,
    # d√©commente les volumes ci-dessous et adapte le chemin.
    # volumes:
    #   - ./kafka-data:/var/lib/kafka/data
